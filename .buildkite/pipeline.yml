steps:

  - label: Test
    plugins:
      docker#v1.1.1:
        image: "python:3.6.5-stretch"
        environment:
          - CODECOV_TOKEN=515ac87b-0f3f-45e2-a46e-20aa32baf273
    command:
      - pip --disable-pip-version-check --no-cache-dir install -r requirements.txt
      - ./test.sh

  - label: Generate pipeline
    command: source .buildkite/generate-pipeline.sh ${BUILDKITE_TAG:-$BUILDKITE_COMMIT} | buildkite-agent pipeline upload
